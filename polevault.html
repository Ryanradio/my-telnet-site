<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Vault Analytics | Kinetic & Grip Engine</title>
    <style>
        :root {
            --primary: #1e293b;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --danger: #ef4444;
            --warning: #f59e0b;
            --success: #10b981;
            --bg: #f1f5f9;
            --card: #ffffff;
            --stall: #64748b;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg);
            color: var(--primary);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            min-height: 100vh;
        }

        .container {
            width: 100%;
            max-width: 900px;
            background: var(--card);
            border-radius: 20px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        header {
            background: var(--primary);
            color: white;
            padding: 2rem 1.5rem;
            text-align: center;
        }
        header h1 { margin: 0; font-size: 1.75rem; letter-spacing: -0.5px; }
        header p { margin: 0.5rem 0 0; opacity: 0.7; font-size: 0.9rem; }

        .content-grid {
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        /* Form Elements */
        .section-label {
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #94a3b8;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .section-label::after { content: ''; flex: 1; height: 1px; background: #e2e8f0; }

        .input-row {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1.25rem;
        }
        .input-group { flex: 1; }

        label {
            display: block;
            font-weight: 600;
            font-size: 0.85rem;
            margin-bottom: 0.4rem;
            color: #475569;
        }

        input, select {
            width: 100%;
            padding: 0.7rem;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 0.95rem;
            background: white;
            transition: all 0.2s;
            box-sizing: border-box;
        }
        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        /* Buttons */
        .btn-calc {
            grid-column: span 2;
            background: var(--accent);
            color: white;
            padding: 1rem;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: background 0.2s;
            margin-top: 1rem;
        }
        .btn-calc:hover { background: var(--accent-hover); }

        /* Results Area */
        .results-container {
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            padding: 2rem;
            display: none; /* Hidden initially */
        }

        /* Slider Section */
        .slider-box {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            border: 1px solid #e2e8f0;
        }

        .slider-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            margin-bottom: 1rem;
        }
        .slider-title { font-weight: 700; color: var(--primary); }
        .slider-val { font-size: 1.5rem; font-weight: 800; color: var(--accent); }
        .slider-sub { font-size: 0.9rem; color: #64748b; font-weight: 500; }

        input[type=range] {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
            cursor: pointer;
            border: none;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            background: var(--accent);
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            transition: transform 0.1s;
        }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.1); }

        /* Dynamic Status Banner */
        .status-banner {
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        /* Status States */
        .st-safe { background: #dcfce7; color: #166534; border-color: #86efac; }
        .st-stall { background: #f1f5f9; color: #475569; border-color: #cbd5e1; } /* Grey/Neutral */
        .st-warn { background: #fef3c7; color: #92400e; border-color: #fcd34d; }
        .st-danger { background: #fee2e2; color: #991b1b; border-color: #fca5a5; }

        /* Metric Cards */
        .metrics-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        .card {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .card-lbl { font-size: 0.75rem; text-transform: uppercase; color: #64748b; font-weight: 700; letter-spacing: 0.5px; }
        .card-val { font-size: 2rem; font-weight: 800; color: var(--primary); margin: 0.5rem 0; }
        .card-sub { font-size: 0.85rem; color: #94a3b8; }

        @media (max-width: 700px) {
            .content-grid { grid-template-columns: 1fr; padding: 1.5rem; gap: 1.5rem; }
            .metrics-grid { grid-template-columns: 1fr; }
            .btn-calc { grid-column: span 1; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>Vault Mechanics Engine</h1>
        <p>Advanced Stiffness, Grip & Velocity Calculator</p>
    </header>

    <div class="content-grid">
        <!-- Left Column: Athlete & Grip -->
        <div>
            <div class="section-label">Athlete Profile</div>
            <div class="input-row">
                <div class="input-group">
                    <label>Weight (lbs)</label>
                    <input type="number" id="weight" placeholder="150" value="150">
                </div>
                <div class="input-group">
                    <label>Height</label>
                    <div style="display:flex; gap:5px;">
                        <input type="number" id="hFt" placeholder="Ft" value="5">
                        <input type="number" id="hIn" placeholder="In" value="10">
                    </div>
                </div>
            </div>

            <div class="section-label">Grip Height</div>
            <div class="input-row">
                <div class="input-group">
                    <label>Feet</label>
                    <select id="gripFt"></select>
                </div>
                <div class="input-group">
                    <label>Inches</label>
                    <select id="gripIn"></select>
                </div>
                <div class="input-group">
                    <label>Fract</label>
                    <select id="gripFrac">
                        <option value="0">0"</option>
                        <option value="0.125">1/8"</option>
                        <option value="0.25">1/4"</option>
                        <option value="0.375">3/8"</option>
                        <option value="0.5">1/2"</option>
                        <option value="0.625">5/8"</option>
                        <option value="0.75">3/4"</option>
                        <option value="0.875">7/8"</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Right Column: Pole Specs -->
        <div>
            <div class="section-label">Pole Configuration</div>
            <div class="input-row">
                <div class="input-group">
                    <label>Brand</label>
                    <select id="brand" onchange="updateFlexEstimate()">
                        <option value="UCS">UCS Spirit</option>
                        <option value="Essx">Essx</option>
                        <option value="Pacer">Gill Pacer</option>
                        <option value="Altius">Altius</option>
                        <option value="Dynasty">Dynasty</option>
                    </select>
                </div>
                <div class="input-group">
                    <label>Length</label>
                    <select id="length" onchange="updateFlexEstimate()"></select>
                </div>
            </div>
            <div class="input-row">
                <div class="input-group">
                    <label>Rating (lbs)</label>
                    <select id="rating" onchange="updateFlexEstimate()"></select>
                </div>
                <div class="input-group">
                    <label>Flex (cm)</label>
                    <input type="number" id="flex" step="0.1" placeholder="Auto">
                </div>
            </div>
        </div>

        <button class="btn-calc" onclick="initSimulation()">Initialize Simulation</button>
    </div>

    <!-- Interactive Results Panel -->
    <div id="results" class="results-container">
        
        <!-- The Kinetic Slider -->
        <div class="slider-box">
            <div class="slider-header">
                <div>
                    <div class="slider-title">Approach Velocity</div>
                    <div class="slider-sub">Slide to test Safe/Stall limits</div>
                </div>
                <div style="text-align: right;">
                    <div class="slider-val" id="speedDisplayMPH">-- mph</div>
                    <div class="slider-sub" id="speedDisplayMS">-- m/s</div>
                </div>
            </div>
            
            <input type="range" id="speedSlider" min="5.0" max="11.0" step="0.05" oninput="runPhysicsEngine()">
            
            <div style="display: flex; justify-content: space-between; margin-top: 5px; font-size: 0.75rem; color: #94a3b8;">
                <span>Jog (11 mph)</span>
                <span>Elite (24 mph)</span>
            </div>
        </div>

        <!-- Dynamic Status -->
        <div id="statusBox" class="status-banner st-safe">
            SYSTEM READY
        </div>

        <!-- Height Cards -->
        <div class="metrics-grid">
            <div class="card">
                <div class="card-lbl">Realistic Limit</div>
                <div class="card-val" id="hReal">--</div>
                <div class="card-sub">Grip + Push Off (If Safe)</div>
            </div>
            <div class="card">
                <div class="card-lbl">Theoretical Ceiling</div>
                <div class="card-val" id="hTheo">--</div>
                <div class="card-sub">Perfect Energy Transfer</div>
            </div>
        </div>
        
        <div style="text-align: center; margin-top: 2rem;">
            <button onclick="resetForm()" style="background:none; border:1px solid #cbd5e1; padding: 8px 16px; border-radius: 6px; color:#64748b; cursor:pointer;">Clear / Reset</button>
        </div>

    </div>
</div>

<script>
    // -- Initialization --
    document.addEventListener("DOMContentLoaded", () => {
        populateDropdowns();
        updateFlexEstimate();
    });

    function populateDropdowns() {
        const lenSel = document.getElementById('length');
        const rateSel = document.getElementById('rating');
        const gripFt = document.getElementById('gripFt');
        const gripIn = document.getElementById('gripIn');

        // Pole Lengths: 10' to 18'
        for(let f = 10; f <= 18; f++) {
            [0, 6].forEach(i => {
                if(f===18 && i===6) return;
                let val = f + (i/12);
                let opt = document.createElement('option');
                opt.value = val;
                opt.text = `${f}' ${i}"`;
                if(val === 15) opt.selected = true; // Default 15' for example
                lenSel.appendChild(opt);
            });
        }

        // Ratings: 90 to 220
        for(let w = 90; w <= 220; w += 5) {
            let opt = document.createElement('option');
            opt.value = w;
            opt.text = `${w} lbs`;
            if(w === 160) opt.selected = true;
            rateSel.appendChild(opt);
        }

        // Grip Feet (10-17)
        for(let f=10; f<=17; f++){
            let opt = document.createElement('option');
            opt.value = f;
            opt.text = `${f}'`;
            if(f===14) opt.selected = true;
            gripFt.appendChild(opt);
        }

        // Grip Inches (0-11)
        for(let i=0; i<=11; i++){
            let opt = document.createElement('option');
            opt.value = i;
            opt.text = `${i}"`;
            if(i===9) opt.selected = true;
            gripIn.appendChild(opt);
        }
        
        // Set Fractional Grip to 1/8" (0.125) as requested default context
        document.getElementById('gripFrac').value = "0.125";
    }

    // -- Logic 1: Flex Estimation --
    function updateFlexEstimate() {
        // Only update if user hasn't typed specifically (optional polish, here we just overwrite for simplicity)
        const length = parseFloat(document.getElementById('length').value);
        const rating = parseInt(document.getElementById('rating').value);
        const brand = document.getElementById('brand').value;
        
        let base = 19.0;
        // Stiffer (Higher rating) = Lower Flex
        base -= (rating - 150) * 0.05;
        // Longer = Higher Flex number for same rating
        base += (length - 14) * 1.4;
        
        // Brand Nuance
        if(brand === 'Essx') base -= 0.6; 
        if(brand === 'Pacer') base += 0.4;
        
        document.getElementById('flex').value = base.toFixed(1);
        
        // Validate Grip isn't higher than pole
        validateGrip();
    }

    function validateGrip() {
        const poleLen = parseFloat(document.getElementById('length').value);
        const gFt = parseInt(document.getElementById('gripFt').value);
        const gIn = parseInt(document.getElementById('gripIn').value);
        const gFr = parseFloat(document.getElementById('gripFrac').value);
        
        const gripTotal = gFt + ((gIn + gFr)/12);
        
        // If grip > pole, warn or clamp? Let's just color code for now.
        const gripLbl = document.querySelector('.section-label:nth-of-type(2)');
        if(gripTotal > poleLen) {
            gripLbl.style.color = "var(--danger)";
            gripLbl.innerText = "GRIP EXCEEDS POLE LENGTH!";
        } else {
            gripLbl.style.color = "#94a3b8";
            gripLbl.innerText = "GRIP HEIGHT";
        }
    }

    // -- Logic 2: The Core Simulation --
    
    // Global calculation variables
    let reqSpeedMS = 0; 
    let stallSpeedMS = 0;
    let blowThroughSpeedMS = 0;
    
    function initSimulation() {
        // 1. Calculate the Physics Baseline
        const weight = parseFloat(document.getElementById('weight').value);
        const rating = parseFloat(document.getElementById('rating').value);
        const flex = parseFloat(document.getElementById('flex').value);
        
        // Effective Stiffness Ratio
        // Compare Pole Rating to Body Weight
        // Also factor in Flex: Is this pole stiffer than a "standard" rating?
        let stiffnessRatio = rating / weight;
        
        // Base speed needed to bend a pole matching your weight (Ratio 1.0)
        // Approx 7.5 m/s is a good collegiate baseline for "safe bend"
        let baseSpeed = 7.5; 
        
        // Adjust based on Stiffness Ratio
        // If Ratio = 1.2 (Pole is 20% over weight), need much more speed
        // If Ratio = 0.9 (Pole is soft), need less speed
        let physicsSpeed = baseSpeed * stiffnessRatio;
        
        // Clamp reasonably
        if(physicsSpeed < 5) physicsSpeed = 5;
        if(physicsSpeed > 10.5) physicsSpeed = 10.5;
        
        reqSpeedMS = physicsSpeed;
        stallSpeedMS = reqSpeedMS - 0.8; // Speed where you definitely reject
        blowThroughSpeedMS = reqSpeedMS + 1.5; // Speed where you crush the pole

        // 2. Set Slider to this "Optimal" Speed
        const slider = document.getElementById('speedSlider');
        slider.value = reqSpeedMS;
        
        // 3. Reveal & Run
        document.getElementById('results').style.display = 'block';
        document.getElementById('results').scrollIntoView({behavior:'smooth'});
        
        runPhysicsEngine();
    }

    function runPhysicsEngine() {
        const sliderVal = parseFloat(document.getElementById('speedSlider').value);
        const mph = sliderVal * 2.23694;
        
        // Update Speed Displays
        document.getElementById('speedDisplayMPH').innerText = mph.toFixed(1) + " mph";
        document.getElementById('speedDisplayMS').innerText = sliderVal.toFixed(2) + " m/s";

        // -- Dynamic Safety Logic --
        const statusBox = document.getElementById('statusBox');
        
        // Get Grip Height Data
        const gFt = parseInt(document.getElementById('gripFt').value);
        const gIn = parseInt(document.getElementById('gripIn').value);
        const gFr = parseFloat(document.getElementById('gripFrac').value);
        const gripFtTotal = gFt + ((gIn + gFr)/12);
        const gripM = gripFtTotal * 0.3048;

        // Push Off Potential (0.65m standard)
        const pushOff = 0.65; 
        
        let realHeightM = 0;
        let note = "";
        
        // Zone Logic
        if (sliderVal < stallSpeedMS) {
            // STALL ZONE
            statusBox.className = "status-banner st-stall";
            statusBox.innerHTML = "⚠️ STALL / REJECTION <br><span style='font-size:0.8em; font-weight:400'>Speed too low to penetrate. Land in box.</span>";
            
            // Height penalty: You don't clear the grip, you fall short
            realHeightM = gripM * 0.8; // Fail to invert
            note = "(Stalled)";
            
        } else if (sliderVal < reqSpeedMS) {
            // DANGER / STRUGGLE ZONE
            statusBox.className = "status-banner st-warn";
            statusBox.innerHTML = "⚠️ UNDER POWERED <br><span style='font-size:0.8em; font-weight:400'>Flagging out. Shallow penetration.</span>";
            
            realHeightM = gripM + (pushOff * 0.2); // Minimal push off
            
        } else if (sliderVal > blowThroughSpeedMS) {
            // BLOW THROUGH
            statusBox.className = "status-banner st-danger";
            statusBox.innerHTML = "⚠️ BLOW THROUGH RISK <br><span style='font-size:0.8em; font-weight:400'>Pole too soft for this speed. Mush out.</span>";
            
            realHeightM = gripM + (pushOff * 0.5); // Loss of lift due to mush
            
        } else {
            // SAFE / OPTIMAL
            statusBox.className = "status-banner st-safe";
            statusBox.innerHTML = "✅ OPTIMAL LAUNCH <br><span style='font-size:0.8em; font-weight:400'>Perfect energy transfer.</span>";
            
            realHeightM = gripM + pushOff;
        }

        // Theoretical (Energy based)
        // h = v^2 / 2g
        // But limited by pole length generally. 
        // Theoretical max is if you caught it perfectly.
        const theoM = (sliderVal * sliderVal) / (2 * 9.81); 
        // *Correction*: In vault, Theo is usually Grip + MaxPush, but limited by Energy.
        // We will display the Max Mechanical Potential of the Grip provided speed is adequate.
        let mechanicsCeiling = gripM + 0.85; // Elite push off
        
        document.getElementById('hReal').innerText = toFtIn(realHeightM) + (note ? " *" : "");
        document.getElementById('hTheo').innerText = toFtIn(mechanicsCeiling);
    }

    function toFtIn(meters) {
        const totalIn = meters * 39.37;
        const f = Math.floor(totalIn / 12);
        const i = Math.round(totalIn % 12);
        const frac = totalIn % 1; 
        // Optional: Add fraction to display if needed, keeping simple for now
        return `${f}' ${i}"`;
    }

    function resetForm() {
        document.getElementById('results').style.display = 'none';
        document.querySelector('.btn-calc').scrollIntoView({behavior:'smooth'});
    }
</script>

</body>
</html>
